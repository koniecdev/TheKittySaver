═══════════════════════════════════════════════════════════════════════════════
                        DOMAIN EVENTS WIRING DOCUMENTATION
                          TheKittySaver - AdoptionSystem
═══════════════════════════════════════════════════════════════════════════════

Poniżej znajduje się mapowanie Domain Eventów z miejsc ich wywołania do Domain
Serwisów, które powinny na nie reagować (gdy będą zaimplementowane handlery).

───────────────────────────────────────────────────────────────────────────────
1. CatUnassignedFromAnnouncementDomainEvent
───────────────────────────────────────────────────────────────────────────────
   Definicja:
   └─ src/AdoptionSystem/Domain/Aggregates/CatAggregate/Events/
      CatUnassignedFromAnnouncementDomainEvent.cs

   Wywoływany z:
   └─ Cat.UnassignFromAdoptionAnnouncement()
      [Cat.cs:82]
      • Gdy kot jest odłączany od ogłoszenia (np. drag-and-drop z powrotem
        do "Moje Koty")
      • Status kota: Published → Draft
      • AdoptionAnnouncementId: ustawiane na null

   Powinien wywołać:
   └─ AdoptionAnnouncementStateService
      • LOGIKA: Sprawdzić czy ogłoszenie (UnassignedAdoptionAnnouncementId)
        jest teraz puste
      • JEŚLI puste → Archive ogłoszenie automatycznie
      • Obecnie serwis jest pusty (AdoptionAnnouncementStateService.cs:3-5)

   Uwagi:
   └─ To kluczowy element "automatycznej archiwizacji pustych ogłoszeń"
      z planu projektu (adherenceToPlan11nov25.txt:145-152)


───────────────────────────────────────────────────────────────────────────────
2. AdoptionAnnouncementClaimedDomainEvent
───────────────────────────────────────────────────────────────────────────────
   Definicja:
   └─ src/AdoptionSystem/Domain/Aggregates/AdoptionAnnouncementAggregate/Events/
      AdoptionAnnouncementClaimedDomainEvent.cs

   Wywoływany z:
   └─ AdoptionAnnouncement.Claim(ClaimedAt claimedAt)
      [AdoptionAnnouncement.cs:88]
      • Gdy ogłoszenie jest oznaczane jako "claimed" (adoptowane)
      • Status: Active → Claimed
      • ClaimedAt: ustawiane

   Powinien wywołać:
   └─ CatClaimService.ClaimAdoptionAnnouncementCatsAsync()
      [CatClaimService.cs:19-42]
      • LOGIKA: Pobiera wszystkie koty przypisane do tego ogłoszenia
      • Wywołuje Cat.Claim() na każdym kocie
      • Propaguje ClaimedAt z ogłoszenia do kotów
      • Oznacza wszystkie koty w ogłoszeniu jako "Claimed"

   Uwagi:
   └─ Gwarantuje spójność: jeśli ogłoszenie jest claimed, wszystkie koty
      w nim również są claimed
   └─ Obsługuje adopcje atomowe (wiele kotów w jednym ogłoszeniu)


───────────────────────────────────────────────────────────────────────────────
3. CatClaimedDomainEvent
───────────────────────────────────────────────────────────────────────────────
   Definicja:
   └─ src/AdoptionSystem/Domain/Aggregates/CatAggregate/Events/
      CatClaimedDomainEvent.cs

   Wywoływany z:
   └─ Cat.Claim(ClaimedAt claimedAt)
      [Cat.cs:191]
      • Gdy pojedynczy kot jest oznaczany jako claimed
      • Status: Published → Claimed
      • ClaimedAt: ustawiane
      • Walidacja: nie można claimować kota w statusie Draft

   Powinien wywołać:
   └─ (Brak bezpośredniego handlera domenowego - prawdopodobnie integration
      event dla notyfikacji/raportowania)

   Uwagi:
   └─ Event wywoływany ZARÓWNO bezpośrednio (jeśli claimujesz kota), JAK I
      pośrednio (przez CatClaimService gdy claimujesz ogłoszenie)
   └─ Może być używany do:
      • Wysyłania powiadomień email
      • Aktualizacji read models
      • Analytics/raportowanie


───────────────────────────────────────────────────────────────────────────────
4. CatUnpublishedDomainEvent
───────────────────────────────────────────────────────────────────────────────
   Definicja:
   └─ src/AdoptionSystem/Domain/Aggregates/CatAggregate/Events/
      CatUnpublishedDomainEvent.cs

   Wywoływany z:
   └─ (BRAK IMPLEMENTACJI - event jest zdefiniowany ale nieużywany)
      • Prawdopodobnie powinien być w metodzie Cat.Unpublish()
        która może nie istnieć jeszcze
      • Status: Published → Draft (?)

   Powinien wywołać:
   └─ (Do określenia - zależy od business logic)
      • Możliwe: AdoptionAnnouncementStateService (podobnie jak przy
        UnassignFromAnnouncement)

   Uwagi:
   └─ Event czeka na implementację
   └─ Wspomniane w planie projektu (adherenceToPlan11nov25.txt:24)


═══════════════════════════════════════════════════════════════════════════════
                              DOMAIN SERVICES OVERVIEW
═══════════════════════════════════════════════════════════════════════════════

Poniżej lista wszystkich Domain Services, które mogą być wywoływane przez
event handlery:

1. AdoptionAnnouncementStateService
   └─ Lokalizacja: src/AdoptionSystem/Domain/Services/
                   AdoptionAnnouncementStateService.cs
   └─ Odpowiedzialność: Zarządzanie stanem ogłoszenia (archiwizacja pustych)
   └─ Status: STUB - tylko komentarz (linia 5)

2. CatClaimService
   └─ Lokalizacja: src/AdoptionSystem/Domain/Services/CatClaimServices/
                   CatClaimService.cs
   └─ Odpowiedzialność: Claimowanie wszystkich kotów w ogłoszeniu
   └─ Metoda: ClaimAdoptionAnnouncementCatsAsync()
   └─ Status: ZAIMPLEMENTOWANE

3. CatAdoptionAnnouncementAssignmentService (ICatAdoptionAnnouncementAssignmentService)
   └─ Lokalizacja: src/AdoptionSystem/Domain/Services/CatAdoptionAnnouncementServices/
                   CatAdoptionAnnouncementAssignmentService.cs
   └─ Odpowiedzialność: Przypisywanie kotów do ogłoszeń z walidacją biznesową
   └─ Metoda: AssignCatToAdoptionAnnouncementAsync()
   └─ Status: ZAIMPLEMENTOWANE
   └─ Uwagi: Waliduje PersonId, StatusType, InfectiousDisease compatibility

4. AdoptionAnnouncementCreationService
   └─ Lokalizacja: src/AdoptionSystem/Domain/Services/AdoptionAnnouncementCreationServices/
                   AdoptionAnnouncementCreationService.cs
   └─ Odpowiedzialność: Tworzenie ogłoszenia + automatyczne przypisanie kota
   └─ Metoda: CreateAndInsertAsync()
   └─ Status: ZAIMPLEMENTOWANE
   └─ Uwagi: Orkiestruje AdoptionAnnouncement.Create() + AssignmentService

5. PersonCreationService (IPersonCreationService)
   └─ Lokalizacja: src/AdoptionSystem/Domain/Aggregates/PersonAggregate/Services/
   └─ Odpowiedzialność: Tworzenie Person aggregate
   └─ Status: ZAIMPLEMENTOWANE

6. PersonUpdateService (IPersonUpdateService)
   └─ Lokalizacja: src/AdoptionSystem/Domain/Aggregates/PersonAggregate/Services/
   └─ Odpowiedzialność: Aktualizacja danych Person
   └─ Status: ZAIMPLEMENTOWANE


═══════════════════════════════════════════════════════════════════════════════
                          IMPLEMENTATION CHECKLIST
═══════════════════════════════════════════════════════════════════════════════

Aby system domain events działał poprawnie, należy zaimplementować:

[ ] 1. Event Dispatcher (w Infrastructure/Persistence - na SaveChangesAsync())
      └─ Pobiera eventy z AggregateRoot.GetDomainEvents()
      └─ Wywołuje odpowiednie handlery
      └─ Czyści eventy przez AggregateRoot.ClearDomainEvents()

[ ] 2. Domain Event Handlers:
      [ ] CatUnassignedFromAnnouncementDomainEventHandler
          └─ Wywołuje AdoptionAnnouncementStateService

      [ ] AdoptionAnnouncementClaimedDomainEventHandler
          └─ Wywołuje CatClaimService.ClaimAdoptionAnnouncementCatsAsync()

      [ ] CatClaimedDomainEventHandler (opcjonalnie)
          └─ Integracje (email, analytics)

[ ] 3. Dokończyć AdoptionAnnouncementStateService
      └─ Implementacja logiki: "jeśli brak kotów → Archive()"

[ ] 4. Rozważyć implementację Cat.Unpublish()
      └─ Raise CatUnpublishedDomainEvent


═══════════════════════════════════════════════════════════════════════════════
                                 NOTES
═══════════════════════════════════════════════════════════════════════════════

• Wszystkie Domain Events dziedziczą z DomainEvent : IDomainEvent
  (src/AdoptionSystem/Domain/Core/BuildingBlocks/DomainEvent.cs)

• AggregateRoot ma prywatną listę _domainEvents i metody:
  - RaiseDomainEvent(IDomainEvent)
  - GetDomainEvents()
  - ClearDomainEvents()

• Eventy są podnoszone WEWNĄTRZ metod agregatu, ale przetwarzane
  DOPIERO przy SaveChangesAsync() (eventual consistency w ramach transakcji)

• Domain Services mogą wywoływać metody na innych agregatach, więc
  jeden event może spowodować cascade eventów (np. AdoptionAnnouncementClaimed
  → Cat.Claim() → CatClaimed event)


═══════════════════════════════════════════════════════════════════════════════
Wygenerowano: 2025-11-13
Autor: Claude Code
═══════════════════════════════════════════════════════════════════════════════
